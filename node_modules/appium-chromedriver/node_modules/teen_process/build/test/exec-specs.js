'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _this = this;

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _ = require('..');

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _helpers = require('./helpers');

require('source-map-support').install();

var should = _chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

describe('exec', function () {
  it('should work with arguments like spawn', function callee$1$0() {
    var cmd, args, _ref, stdout, stderr, code;

    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = 'ls';
          args = [__dirname];
          context$2$0.next = 4;
          return _.exec(cmd, args);

        case 4:
          _ref = context$2$0.sent;
          stdout = _ref.stdout;
          stderr = _ref.stderr;
          code = _ref.code;

          stdout.should.contain('exec-specs.js');
          stderr.should.equal('');
          code.should.equal(0);

        case 11:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should throw an error with a bad exit code', function callee$1$1() {
    var cmd, err;
    return _regeneratorRuntime.async(function callee$1$1$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = _helpers.getFixture('bad_exit.sh');
          err = undefined;
          context$2$0.prev = 2;
          context$2$0.next = 5;
          return _.exec(cmd);

        case 5:
          context$2$0.next = 10;
          break;

        case 7:
          context$2$0.prev = 7;
          context$2$0.t0 = context$2$0['catch'](2);

          err = context$2$0.t0;

        case 10:
          should.exist(err);
          err.stdout.trim().should.equal('foo');
          err.stderr.trim().should.equal('bar');
          err.code.should.equal(1);

        case 14:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this, [[2, 7]]);
  });

  it('should work with spaces in arguments', function callee$1$2() {
    var cmd, echo1, echo2, _ref2, stdout, stderr, code;

    return _regeneratorRuntime.async(function callee$1$2$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = _helpers.getFixture('echo.sh');
          echo1 = 'my name is bob';
          echo2 = 'lol';
          context$2$0.next = 5;
          return _.exec(cmd, [echo1, echo2]);

        case 5:
          _ref2 = context$2$0.sent;
          stdout = _ref2.stdout;
          stderr = _ref2.stderr;
          code = _ref2.code;

          stdout.trim().should.equal(echo1);
          stderr.trim().should.equal(echo2);
          code.should.equal(0);

        case 12:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should work with backslashes in arguments', function callee$1$3() {
    var cmd, echo1, echo2, _ref3, stdout, stderr, code;

    return _regeneratorRuntime.async(function callee$1$3$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = _helpers.getFixture('echo.sh');
          echo1 = 'my\\ name\\ is\\ bob';
          echo2 = 'lol';
          context$2$0.next = 5;
          return _.exec(cmd, [echo1, echo2]);

        case 5:
          _ref3 = context$2$0.sent;
          stdout = _ref3.stdout;
          stderr = _ref3.stderr;
          code = _ref3.code;

          stdout.trim().should.equal(echo1);
          stderr.trim().should.equal(echo2);
          code.should.equal(0);

        case 12:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should work with spaces in commands', function callee$1$4() {
    var cmd, echo1, echo2, _ref4, stdout, stderr, code;

    return _regeneratorRuntime.async(function callee$1$4$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = _helpers.getFixture('echo with space.sh');
          echo1 = 'my name is bob';
          echo2 = 'lol';
          context$2$0.next = 5;
          return _.exec(cmd, [echo1, echo2]);

        case 5:
          _ref4 = context$2$0.sent;
          stdout = _ref4.stdout;
          stderr = _ref4.stderr;
          code = _ref4.code;

          stdout.trim().should.equal(echo1);
          stderr.trim().should.equal(echo2);
          code.should.equal(0);

        case 12:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should respect cwd', function callee$1$5() {
    var cmd, echo1, echo2, cwd, _ref5, stdout, stderr, code;

    return _regeneratorRuntime.async(function callee$1$5$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = './echo.sh';
          echo1 = 'my name is bob';
          echo2 = 'lol';
          cwd = _path2['default'].dirname(_helpers.getFixture('echo.sh'));
          context$2$0.next = 6;
          return _.exec(cmd, [echo1, echo2], { cwd: cwd });

        case 6:
          _ref5 = context$2$0.sent;
          stdout = _ref5.stdout;
          stderr = _ref5.stderr;
          code = _ref5.code;

          stdout.trim().should.equal(echo1);
          stderr.trim().should.equal(echo2);
          code.should.equal(0);

        case 13:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should respect env', function callee$1$6() {
    var cmd, env, _ref6, stdout, code;

    return _regeneratorRuntime.async(function callee$1$6$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = _helpers.getFixture('env.sh');
          env = { FOO: 'lolol' };
          context$2$0.next = 4;
          return _.exec(cmd, [], { env: env });

        case 4:
          _ref6 = context$2$0.sent;
          stdout = _ref6.stdout;
          code = _ref6.code;

          stdout.trim().should.equal('' + env.FOO + ' ' + env.FOO);
          code.should.equal(0);

        case 9:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should allow a timeout parameter', function callee$1$7() {
    var cmd, args, err;
    return _regeneratorRuntime.async(function callee$1$7$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = 'sleep';
          args = ['10'];
          err = undefined;
          context$2$0.prev = 3;
          context$2$0.next = 6;
          return _.exec(cmd, args, { timeout: 500 });

        case 6:
          context$2$0.next = 11;
          break;

        case 8:
          context$2$0.prev = 8;
          context$2$0.t1 = context$2$0['catch'](3);

          err = context$2$0.t1;

        case 11:
          should.exist(err);
          err.message.should.contain('timed out');
          err.message.should.contain(cmd);

        case 14:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this, [[3, 8]]);
  });

  it('should allow large amounts of output', function callee$1$8() {
    var _ref7, stdout;

    return _regeneratorRuntime.async(function callee$1$8$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          this.timeout(10000);
          context$2$0.next = 3;
          return _.exec(_helpers.getFixture('bigbuffer.js'));

        case 3:
          _ref7 = context$2$0.sent;
          stdout = _ref7.stdout;

          stdout.length.should.be.above(512 * 1024);

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  it('should ignore output if requested', function callee$1$9() {
    var cmd, echo1, _ref8, stdout, code;

    return _regeneratorRuntime.async(function callee$1$9$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          cmd = _helpers.getFixture('echo.sh');
          echo1 = 'my name is bob';
          context$2$0.next = 4;
          return _.exec(cmd, [echo1], { ignoreOutput: true });

        case 4:
          _ref8 = context$2$0.sent;
          stdout = _ref8.stdout;
          code = _ref8.code;

          stdout.should.equal('');
          code.should.equal(0);

        case 9:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
});
//# sourceMappingURL=data:application/json;base64,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UUFDbEMsR0FBRyxFQUNILEtBQUssU0FDSixNQUFNLEVBQUUsSUFBSTs7Ozs7QUFGYixhQUFHLEdBQUcsU0FwR0wsVUFBVSxDQW9HTSxTQUFTLENBQUM7QUFDM0IsZUFBSyxHQUFHLGdCQUFnQjs7aUJBQ0QsRUF6R3RCLElBQUksQ0F5R3VCLEdBQUcsRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUMsWUFBWSxFQUFFLElBQUksRUFBQyxDQUFDOzs7O0FBQTlELGdCQUFNLFNBQU4sTUFBTTtBQUFFLGNBQUksU0FBSixJQUFJOztBQUNqQixnQkFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7QUFDeEIsY0FBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Ozs7Ozs7R0FDdEIsQ0FBQyxDQUFDO0NBQ0osQ0FBQyxDQUFDIiwiZmlsZSI6InRlc3QvZXhlYy1zcGVjcy5qcyIsInNvdXJjZXNDb250ZW50IjpbInJlcXVpcmUoJ3NvdXJjZS1tYXAtc3VwcG9ydCcpLmluc3RhbGwoKTtcblxuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSAnLi4nO1xuaW1wb3J0IGNoYWkgZnJvbSAnY2hhaSc7XG5pbXBvcnQgY2hhaUFzUHJvbWlzZWQgZnJvbSAnY2hhaS1hcy1wcm9taXNlZCc7XG5pbXBvcnQgeyBnZXRGaXh0dXJlIH0gZnJvbSAnLi9oZWxwZXJzJztcblxuXG5jb25zdCBzaG91bGQgPSBjaGFpLnNob3VsZCgpO1xuY2hhaS51c2UoY2hhaUFzUHJvbWlzZWQpO1xuXG5kZXNjcmliZSgnZXhlYycsICgpID0+IHtcbiAgaXQoJ3Nob3VsZCB3b3JrIHdpdGggYXJndW1lbnRzIGxpa2Ugc3Bhd24nLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGNtZCA9ICdscyc7XG4gICAgbGV0IGFyZ3MgPSBbX19kaXJuYW1lXTtcbiAgICBsZXQge3N0ZG91dCwgc3RkZXJyLCBjb2RlfSA9IGF3YWl0IGV4ZWMoY21kLCBhcmdzKTtcbiAgICBzdGRvdXQuc2hvdWxkLmNvbnRhaW4oXCJleGVjLXNwZWNzLmpzXCIpO1xuICAgIHN0ZGVyci5zaG91bGQuZXF1YWwoXCJcIik7XG4gICAgY29kZS5zaG91bGQuZXF1YWwoMCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgdGhyb3cgYW4gZXJyb3Igd2l0aCBhIGJhZCBleGl0IGNvZGUnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGNtZCA9IGdldEZpeHR1cmUoXCJiYWRfZXhpdC5zaFwiKTtcbiAgICBsZXQgZXJyO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBleGVjKGNtZCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgZXJyID0gZTtcbiAgICB9XG4gICAgc2hvdWxkLmV4aXN0KGVycik7XG4gICAgZXJyLnN0ZG91dC50cmltKCkuc2hvdWxkLmVxdWFsKFwiZm9vXCIpO1xuICAgIGVyci5zdGRlcnIudHJpbSgpLnNob3VsZC5lcXVhbChcImJhclwiKTtcbiAgICBlcnIuY29kZS5zaG91bGQuZXF1YWwoMSk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgd29yayB3aXRoIHNwYWNlcyBpbiBhcmd1bWVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGNtZCA9IGdldEZpeHR1cmUoXCJlY2hvLnNoXCIpO1xuICAgIGxldCBlY2hvMSA9IFwibXkgbmFtZSBpcyBib2JcIjtcbiAgICBsZXQgZWNobzIgPSBcImxvbFwiO1xuICAgIGxldCB7c3Rkb3V0LCBzdGRlcnIsIGNvZGV9ID0gYXdhaXQgZXhlYyhjbWQsIFtlY2hvMSwgZWNobzJdKTtcbiAgICBzdGRvdXQudHJpbSgpLnNob3VsZC5lcXVhbChlY2hvMSk7XG4gICAgc3RkZXJyLnRyaW0oKS5zaG91bGQuZXF1YWwoZWNobzIpO1xuICAgIGNvZGUuc2hvdWxkLmVxdWFsKDApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHdvcmsgd2l0aCBiYWNrc2xhc2hlcyBpbiBhcmd1bWVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGNtZCA9IGdldEZpeHR1cmUoXCJlY2hvLnNoXCIpO1xuICAgIGxldCBlY2hvMSA9IFwibXlcXFxcIG5hbWVcXFxcIGlzXFxcXCBib2JcIjtcbiAgICBsZXQgZWNobzIgPSBcImxvbFwiO1xuICAgIGxldCB7c3Rkb3V0LCBzdGRlcnIsIGNvZGV9ID0gYXdhaXQgZXhlYyhjbWQsIFtlY2hvMSwgZWNobzJdKTtcbiAgICBzdGRvdXQudHJpbSgpLnNob3VsZC5lcXVhbChlY2hvMSk7XG4gICAgc3RkZXJyLnRyaW0oKS5zaG91bGQuZXF1YWwoZWNobzIpO1xuICAgIGNvZGUuc2hvdWxkLmVxdWFsKDApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHdvcmsgd2l0aCBzcGFjZXMgaW4gY29tbWFuZHMnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGNtZCA9IGdldEZpeHR1cmUoXCJlY2hvIHdpdGggc3BhY2Uuc2hcIik7XG4gICAgbGV0IGVjaG8xID0gXCJteSBuYW1lIGlzIGJvYlwiO1xuICAgIGxldCBlY2hvMiA9IFwibG9sXCI7XG4gICAgbGV0IHtzdGRvdXQsIHN0ZGVyciwgY29kZX0gPSBhd2FpdCBleGVjKGNtZCwgW2VjaG8xLCBlY2hvMl0pO1xuICAgIHN0ZG91dC50cmltKCkuc2hvdWxkLmVxdWFsKGVjaG8xKTtcbiAgICBzdGRlcnIudHJpbSgpLnNob3VsZC5lcXVhbChlY2hvMik7XG4gICAgY29kZS5zaG91bGQuZXF1YWwoMCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgcmVzcGVjdCBjd2QnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGNtZCA9IFwiLi9lY2hvLnNoXCI7XG4gICAgbGV0IGVjaG8xID0gXCJteSBuYW1lIGlzIGJvYlwiO1xuICAgIGxldCBlY2hvMiA9IFwibG9sXCI7XG4gICAgbGV0IGN3ZCA9IHBhdGguZGlybmFtZShnZXRGaXh0dXJlKFwiZWNoby5zaFwiKSk7XG4gICAgbGV0IHtzdGRvdXQsIHN0ZGVyciwgY29kZX0gPSBhd2FpdCBleGVjKGNtZCwgW2VjaG8xLCBlY2hvMl0sIHtjd2R9KTtcbiAgICBzdGRvdXQudHJpbSgpLnNob3VsZC5lcXVhbChlY2hvMSk7XG4gICAgc3RkZXJyLnRyaW0oKS5zaG91bGQuZXF1YWwoZWNobzIpO1xuICAgIGNvZGUuc2hvdWxkLmVxdWFsKDApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHJlc3BlY3QgZW52JywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBjbWQgPSBnZXRGaXh0dXJlKFwiZW52LnNoXCIpO1xuICAgIGxldCBlbnYgPSB7Rk9POiBcImxvbG9sXCJ9O1xuICAgIGxldCB7c3Rkb3V0LCBjb2RlfSA9IGF3YWl0IGV4ZWMoY21kLCBbXSwge2Vudn0pO1xuICAgIHN0ZG91dC50cmltKCkuc2hvdWxkLmVxdWFsKGAke2Vudi5GT099ICR7ZW52LkZPT31gKTtcbiAgICBjb2RlLnNob3VsZC5lcXVhbCgwKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBhbGxvdyBhIHRpbWVvdXQgcGFyYW1ldGVyJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBjbWQgPSBcInNsZWVwXCI7XG4gICAgbGV0IGFyZ3MgPSBbXCIxMFwiXTtcbiAgICBsZXQgZXJyO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBleGVjKGNtZCwgYXJncywge3RpbWVvdXQ6IDUwMH0pO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGVyciA9IGU7XG4gICAgfVxuICAgIHNob3VsZC5leGlzdChlcnIpO1xuICAgIGVyci5tZXNzYWdlLnNob3VsZC5jb250YWluKFwidGltZWQgb3V0XCIpO1xuICAgIGVyci5tZXNzYWdlLnNob3VsZC5jb250YWluKGNtZCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgYWxsb3cgbGFyZ2UgYW1vdW50cyBvZiBvdXRwdXQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy50aW1lb3V0KDEwMDAwKTtcbiAgICBsZXQge3N0ZG91dH0gPSBhd2FpdCBleGVjKGdldEZpeHR1cmUoXCJiaWdidWZmZXIuanNcIikpO1xuICAgIHN0ZG91dC5sZW5ndGguc2hvdWxkLmJlLmFib3ZlKDUxMiAqIDEwMjQpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGlnbm9yZSBvdXRwdXQgaWYgcmVxdWVzdGVkJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBjbWQgPSBnZXRGaXh0dXJlKFwiZWNoby5zaFwiKTtcbiAgICBsZXQgZWNobzEgPSBcIm15IG5hbWUgaXMgYm9iXCI7XG4gICAgbGV0IHtzdGRvdXQsIGNvZGV9ID0gYXdhaXQgZXhlYyhjbWQsIFtlY2hvMV0sIHtpZ25vcmVPdXRwdXQ6IHRydWV9KTtcbiAgICBzdGRvdXQuc2hvdWxkLmVxdWFsKFwiXCIpO1xuICAgIGNvZGUuc2hvdWxkLmVxdWFsKDApO1xuICB9KTtcbn0pO1xuXG4iXX0=