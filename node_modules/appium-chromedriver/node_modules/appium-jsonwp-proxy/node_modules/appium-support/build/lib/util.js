'use strict';

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.hasContent = hasContent;

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _os = require('os');

var _os2 = _interopRequireDefault(_os);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

function hasContent(val) {
  return _lodash2['default'].isString(val) && val !== "";
}

// return true if the the value is not undefined, null, or NaN.
function hasValue(val) {
  var hasVal = false;
  // avoid incorrectly evaluating `0` as false
  if (_lodash2['default'].isNumber(val)) {
    hasVal = !_lodash2['default'].isNaN(val);
  } else {
    hasVal = !_lodash2['default'].isUndefined(val) && !_lodash2['default'].isNull(val);
  }

  return hasVal;
}

// escape spaces in string, for commandline calls
function escapeSpace(str) {
  return str.split(/ /).join('\\ ');
}

function escapeSpecialChars(str, quoteEscape) {
  if (typeof str !== "string") {
    return str;
  }
  if (typeof quoteEscape === "undefined") {
    quoteEscape = false;
  }
  str = str.replace(/[\\]/g, '\\\\').replace(/[\/]/g, '\\/').replace(/[\b]/g, '\\b').replace(/[\f]/g, '\\f').replace(/[\n]/g, '\\n').replace(/[\r]/g, '\\r').replace(/[\t]/g, '\\t').replace(/[\"]/g, '\\"').replace(/\\'/g, "\\'");
  if (quoteEscape) {
    var re = new RegExp(quoteEscape, "g");
    str = str.replace(re, "\\" + quoteEscape);
  }
  return str;
}

function localIp() {
  var ip = _lodash2['default'].chain(_os2['default'].networkInterfaces()).values().flatten().filter(function (val) {
    return val.family === 'IPv4' && val.internal === false;
  }).pluck('address').first().value();
  return ip;
}

/*
 * Creates a promise that is cancellable, and will timeout
 * after `ms` delay
 */
function cancellableDelay(ms) {
  var timer = undefined;
  return new _bluebird2['default'].Promise(function (resolve) {
    timer = setTimeout(function () {
      resolve();
    }, ms);
  }).cancellable()['catch'](_bluebird2['default'].CancellationError, function (err) {
    clearTimeout(timer);
    throw err;
  });
}

function multiResolve(roots) {
  for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
    args[_key - 1] = arguments[_key];
  }

  return roots.map(function (root) {
    return _path2['default'].resolve.apply(_path2['default'], [root].concat(args));
  });
}

/*
 * Parses an object if possible. Otherwise returns the object without parsing.
 */
function safeJsonParse(obj) {
  try {
    obj = JSON.parse(obj);
  } catch (ign) {
    // ignore: this is not json parsable
  }
  return obj;
}

exports.hasValue = hasValue;
exports.escapeSpace = escapeSpace;
exports.escapeSpecialChars = escapeSpecialChars;
exports.localIp = localIp;
exports.cancellableDelay = cancellableDelay;
exports.multiResolve = multiResolve;
exports.safeJsonParse = safeJsonParse;
//# sourceMappingURL=data:application/json;base64,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WCxFQUFFLEVBQUUsQ0FBQyxDQUFDO0dBQ1IsQ0FBQyxDQUNELFdBQVcsRUFBRSxTQUNSLENBQUMsc0JBQUUsaUJBQWlCLEVBQUUsVUFBQyxHQUFHLEVBQUs7QUFDbkMsZ0JBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNwQixVQUFNLEdBQUcsQ0FBQztHQUNYLENBQUMsQ0FBQztDQUNKOztBQUVELFNBQVMsWUFBWSxDQUFFLEtBQUssRUFBVztvQ0FBTixJQUFJO0FBQUosUUFBSTs7O0FBQ25DLFNBQU8sS0FBSyxDQUFDLEdBQUcsQ0FBQyxVQUFDLElBQUksRUFBSztBQUN6QixXQUFPLGtCQUFLLE9BQU8sTUFBQSxxQkFBQyxJQUFJLFNBQUssSUFBSSxFQUFDLENBQUM7R0FDcEMsQ0FBQyxDQUFDO0NBQ0o7Ozs7O0FBS0QsU0FBUyxhQUFhLENBQUUsR0FBRyxFQUFFO0FBQzNCLE1BQUk7QUFDRixPQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztHQUN2QixDQUFDLE9BQU8sR0FBRyxFQUFFOztHQUViO0FBQ0QsU0FBTyxHQUFHLENBQUM7Q0FDWjs7UUFFUSxRQUFRLEdBQVIsUUFBUTtRQUFFLFdBQVcsR0FBWCxXQUFXO1FBQUUsa0JBQWtCLEdBQWxCLGtCQUFrQjtRQUFFLE9BQU8sR0FBUCxPQUFPO1FBQUUsZ0JBQWdCLEdBQWhCLGdCQUFnQjtRQUFFLFlBQVksR0FBWixZQUFZO1FBQUUsYUFBYSxHQUFiLGFBQWEiLCJmaWxlIjoibGliL3V0aWwuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IG9zIGZyb20gJ29zJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuXG5leHBvcnQgZnVuY3Rpb24gaGFzQ29udGVudCAodmFsKSB7XG4gIHJldHVybiBfLmlzU3RyaW5nKHZhbCkgJiYgdmFsICE9PSBcIlwiO1xufVxuXG4vLyByZXR1cm4gdHJ1ZSBpZiB0aGUgdGhlIHZhbHVlIGlzIG5vdCB1bmRlZmluZWQsIG51bGwsIG9yIE5hTi5cbmZ1bmN0aW9uIGhhc1ZhbHVlICh2YWwpIHtcbiAgbGV0IGhhc1ZhbCA9IGZhbHNlO1xuICAvLyBhdm9pZCBpbmNvcnJlY3RseSBldmFsdWF0aW5nIGAwYCBhcyBmYWxzZVxuICBpZiAoXy5pc051bWJlcih2YWwpKSB7XG4gICAgaGFzVmFsID0gIV8uaXNOYU4odmFsKTtcbiAgfSBlbHNlIHtcbiAgICBoYXNWYWwgPSAhXy5pc1VuZGVmaW5lZCh2YWwpICYmICFfLmlzTnVsbCh2YWwpO1xuICB9XG5cbiAgcmV0dXJuIGhhc1ZhbDtcbn1cblxuLy8gZXNjYXBlIHNwYWNlcyBpbiBzdHJpbmcsIGZvciBjb21tYW5kbGluZSBjYWxsc1xuZnVuY3Rpb24gZXNjYXBlU3BhY2UgKHN0cikge1xuICByZXR1cm4gc3RyLnNwbGl0KC8gLykuam9pbignXFxcXCAnKTtcbn1cblxuZnVuY3Rpb24gZXNjYXBlU3BlY2lhbENoYXJzIChzdHIsIHF1b3RlRXNjYXBlKSB7XG4gIGlmICh0eXBlb2Ygc3RyICE9PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIHN0cjtcbiAgfVxuICBpZiAodHlwZW9mIHF1b3RlRXNjYXBlID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgcXVvdGVFc2NhcGUgPSBmYWxzZTtcbiAgfVxuICBzdHIgPSBzdHJcbiAgICAgICAgLnJlcGxhY2UoL1tcXFxcXS9nLCAnXFxcXFxcXFwnKVxuICAgICAgICAucmVwbGFjZSgvW1xcL10vZywgJ1xcXFwvJylcbiAgICAgICAgLnJlcGxhY2UoL1tcXGJdL2csICdcXFxcYicpXG4gICAgICAgIC5yZXBsYWNlKC9bXFxmXS9nLCAnXFxcXGYnKVxuICAgICAgICAucmVwbGFjZSgvW1xcbl0vZywgJ1xcXFxuJylcbiAgICAgICAgLnJlcGxhY2UoL1tcXHJdL2csICdcXFxccicpXG4gICAgICAgIC5yZXBsYWNlKC9bXFx0XS9nLCAnXFxcXHQnKVxuICAgICAgICAucmVwbGFjZSgvW1xcXCJdL2csICdcXFxcXCInKVxuICAgICAgICAucmVwbGFjZSgvXFxcXCcvZywgXCJcXFxcJ1wiKTtcbiAgaWYgKHF1b3RlRXNjYXBlKSB7XG4gICAgdmFyIHJlID0gbmV3IFJlZ0V4cChxdW90ZUVzY2FwZSwgXCJnXCIpO1xuICAgIHN0ciA9IHN0ci5yZXBsYWNlKHJlLCBcIlxcXFxcIiArIHF1b3RlRXNjYXBlKTtcbiAgfVxuICByZXR1cm4gc3RyO1xufVxuXG5mdW5jdGlvbiBsb2NhbElwICgpIHtcbiAgbGV0IGlwID0gXy5jaGFpbihvcy5uZXR3b3JrSW50ZXJmYWNlcygpKVxuICAgIC52YWx1ZXMoKVxuICAgIC5mbGF0dGVuKClcbiAgICAuZmlsdGVyKGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgIHJldHVybiAodmFsLmZhbWlseSA9PT0gJ0lQdjQnICYmIHZhbC5pbnRlcm5hbCA9PT0gZmFsc2UpO1xuICAgIH0pXG4gICAgLnBsdWNrKCdhZGRyZXNzJylcbiAgICAuZmlyc3QoKVxuICAgIC52YWx1ZSgpO1xuICByZXR1cm4gaXA7XG59XG5cbi8qXG4gKiBDcmVhdGVzIGEgcHJvbWlzZSB0aGF0IGlzIGNhbmNlbGxhYmxlLCBhbmQgd2lsbCB0aW1lb3V0XG4gKiBhZnRlciBgbXNgIGRlbGF5XG4gKi9cbmZ1bmN0aW9uIGNhbmNlbGxhYmxlRGVsYXkgKG1zKSB7XG4gIGxldCB0aW1lcjtcbiAgcmV0dXJuIG5ldyBCLlByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICB0aW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICByZXNvbHZlKCk7XG4gICAgfSwgbXMpO1xuICB9KVxuICAuY2FuY2VsbGFibGUoKVxuICAuY2F0Y2goQi5DYW5jZWxsYXRpb25FcnJvciwgKGVycikgPT4ge1xuICAgIGNsZWFyVGltZW91dCh0aW1lcik7XG4gICAgdGhyb3cgZXJyO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gbXVsdGlSZXNvbHZlIChyb290cywgLi4uYXJncykge1xuICByZXR1cm4gcm9vdHMubWFwKChyb290KSA9PiB7XG4gICAgcmV0dXJuIHBhdGgucmVzb2x2ZShyb290LCAuLi5hcmdzKTtcbiAgfSk7XG59XG5cbi8qXG4gKiBQYXJzZXMgYW4gb2JqZWN0IGlmIHBvc3NpYmxlLiBPdGhlcndpc2UgcmV0dXJucyB0aGUgb2JqZWN0IHdpdGhvdXQgcGFyc2luZy5cbiAqL1xuZnVuY3Rpb24gc2FmZUpzb25QYXJzZSAob2JqKSB7XG4gIHRyeSB7XG4gICAgb2JqID0gSlNPTi5wYXJzZShvYmopO1xuICB9IGNhdGNoIChpZ24pIHtcbiAgICAvLyBpZ25vcmU6IHRoaXMgaXMgbm90IGpzb24gcGFyc2FibGVcbiAgfVxuICByZXR1cm4gb2JqO1xufVxuXG5leHBvcnQgeyBoYXNWYWx1ZSwgZXNjYXBlU3BhY2UsIGVzY2FwZVNwZWNpYWxDaGFycywgbG9jYWxJcCwgY2FuY2VsbGFibGVEZWxheSwgbXVsdGlSZXNvbHZlLCBzYWZlSnNvblBhcnNlIH07XG4iXX0=