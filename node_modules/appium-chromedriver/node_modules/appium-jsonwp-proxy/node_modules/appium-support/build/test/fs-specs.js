'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _indexJs = require('../index.js');

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _teen_process = require('teen_process');

var should = _chai2['default'].should();

describe('fs', function () {
  var _this = this;

  it("should exist", function () {
    should.exist(_indexJs.fs);
  });
  it("should have expected methods", function () {
    should.exist(_indexJs.fs.open);
    should.exist(_indexJs.fs.close);
    should.exist(_indexJs.fs.access);
    should.exist(_indexJs.fs.mkdir);
    should.exist(_indexJs.fs.readlink);
    should.exist(_indexJs.fs.exists);
    should.exist(_indexJs.fs.rimraf);
    should.exist(_indexJs.fs.readFile);
    should.exist(_indexJs.fs.writeFile);
    should.exist(_indexJs.fs.lstat);
    should.exist(_indexJs.fs.mv);
  });

  describe("mkdir", function () {
    var dirName = _path2['default'].resolve(__dirname, "tmp");

    it("should make a directory that doesn't exist", function callee$2$0() {
      var exists;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_indexJs.fs.rimraf(dirName));

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(_indexJs.fs.mkdir(dirName));

          case 4:
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(_indexJs.fs.hasAccess(dirName));

          case 6:
            exists = context$3$0.sent;

            exists.should.be['true'];

          case 8:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it("should not complain if the dir already exists", function callee$2$0() {
      var exists;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_indexJs.fs.hasAccess(dirName));

          case 2:
            exists = context$3$0.sent;

            exists.should.be['true'];
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(_indexJs.fs.mkdir(dirName));

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it("should still throw an error if something else goes wrong", function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_indexJs.fs.mkdir("/bin/foo").should.be.rejected);

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });

  it('hasAccess', function callee$1$0() {
    var existingPath, nonExistingPath;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          existingPath = _path2['default'].resolve(__dirname, 'fs-specs.js');
          context$2$0.next = 3;
          return _regeneratorRuntime.awrap(_indexJs.fs.exists(existingPath));

        case 3:
          context$2$0.sent.should.be.ok;
          nonExistingPath = _path2['default'].resolve(__dirname, 'wrong-specs.js');
          context$2$0.next = 7;
          return _regeneratorRuntime.awrap(_indexJs.fs.hasAccess(nonExistingPath));

        case 7:
          context$2$0.sent.should.not.be.ok;

        case 8:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('exists', function callee$1$0() {
    var existingPath, nonExistingPath;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          existingPath = _path2['default'].resolve(__dirname, 'fs-specs.js');
          context$2$0.next = 3;
          return _regeneratorRuntime.awrap(_indexJs.fs.exists(existingPath));

        case 3:
          context$2$0.sent.should.be.ok;
          nonExistingPath = _path2['default'].resolve(__dirname, 'wrong-specs.js');
          context$2$0.next = 7;
          return _regeneratorRuntime.awrap(_indexJs.fs.exists(nonExistingPath));

        case 7:
          context$2$0.sent.should.not.be.ok;

        case 8:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('readFile', function callee$1$0() {
    var existingPath;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          existingPath = _path2['default'].resolve(__dirname, 'fs-specs.js');
          context$2$0.next = 3;
          return _regeneratorRuntime.awrap(_indexJs.fs.readFile(existingPath, 'utf8'));

        case 3:
          context$2$0.sent.should.contain('readFile');

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('copyFile', function callee$1$0() {
    var existingPath, newPath;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          existingPath = _path2['default'].resolve(__dirname, 'fs-specs.js');
          newPath = _path2['default'].resolve('/tmp', 'fs-specs.js');
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap(_indexJs.fs.copyFile(existingPath, newPath));

        case 4:
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(_indexJs.fs.readFile(newPath, 'utf8'));

        case 6:
          context$2$0.sent.should.contain('readFile');

        case 7:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('rimraf', function callee$1$0() {
    var newPath;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          newPath = _path2['default'].resolve('/tmp', 'fs-specs.js');
          context$2$0.next = 3;
          return _regeneratorRuntime.awrap(_indexJs.fs.exists(newPath));

        case 3:
          context$2$0.sent.should.be['true'];
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(_indexJs.fs.rimraf(newPath));

        case 6:
          context$2$0.next = 8;
          return _regeneratorRuntime.awrap(_indexJs.fs.exists(newPath));

        case 8:
          context$2$0.sent.should.be['false'];

        case 9:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('md5', function callee$1$0() {
    var existingPath;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          existingPath = _path2['default'].resolve(__dirname, 'fs-specs.js');
          context$2$0.next = 3;
          return _regeneratorRuntime.awrap(_indexJs.fs.md5(existingPath));

        case 3:
          context$2$0.sent.should.have.length(32);

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('stat', function callee$1$0() {
    var existingPath, stat;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          existingPath = _path2['default'].resolve(__dirname, 'fs-specs.js');
          context$2$0.next = 3;
          return _regeneratorRuntime.awrap(_indexJs.fs.stat(existingPath));

        case 3:
          stat = context$2$0.sent;

          stat.should.have.property('atime');

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('which', function callee$1$0() {
    var systemNpmPath, npmPath;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap((0, _teen_process.exec)('which', ['npm']));

        case 2:
          systemNpmPath = context$2$0.sent.stdout.trim();
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(_indexJs.fs.which('npm'));

        case 5:
          npmPath = context$2$0.sent;

          npmPath.should.equal(systemNpmPath);

        case 7:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
  it('glob', function callee$1$0() {
    var glob, tests;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          glob = 'test/*-specs.js';
          context$2$0.next = 3;
          return _regeneratorRuntime.awrap(_indexJs.fs.glob(glob));

        case 3:
          tests = context$2$0.sent;

          tests.should.be.an('array');
          tests.should.have.length.above(2);

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
});
//# sourceMappingURL=data:application/json;base64,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Q0FBQyxJQUFJLENBQUM7OztBQUEzQixlQUFLOztBQUNULGVBQUssQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUM1QixlQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDOzs7Ozs7O0dBQ25DLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L2ZzLXNwZWNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZnMgfSBmcm9tICcuLi9pbmRleC5qcyc7XG5pbXBvcnQgY2hhaSBmcm9tICdjaGFpJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5cblxubGV0IHNob3VsZCA9IGNoYWkuc2hvdWxkKCk7XG5cbmRlc2NyaWJlKCdmcycsIGZ1bmN0aW9uICgpIHtcbiAgaXQoXCJzaG91bGQgZXhpc3RcIiwgZnVuY3Rpb24gKCkge1xuICAgIHNob3VsZC5leGlzdChmcyk7XG4gIH0pO1xuICBpdChcInNob3VsZCBoYXZlIGV4cGVjdGVkIG1ldGhvZHNcIiwgZnVuY3Rpb24gKCkge1xuICAgIHNob3VsZC5leGlzdChmcy5vcGVuKTtcbiAgICBzaG91bGQuZXhpc3QoZnMuY2xvc2UpO1xuICAgIHNob3VsZC5leGlzdChmcy5hY2Nlc3MpO1xuICAgIHNob3VsZC5leGlzdChmcy5ta2Rpcik7XG4gICAgc2hvdWxkLmV4aXN0KGZzLnJlYWRsaW5rKTtcbiAgICBzaG91bGQuZXhpc3QoZnMuZXhpc3RzKTtcbiAgICBzaG91bGQuZXhpc3QoZnMucmltcmFmKTtcbiAgICBzaG91bGQuZXhpc3QoZnMucmVhZEZpbGUpO1xuICAgIHNob3VsZC5leGlzdChmcy53cml0ZUZpbGUpO1xuICAgIHNob3VsZC5leGlzdChmcy5sc3RhdCk7XG4gICAgc2hvdWxkLmV4aXN0KGZzLm12KTtcbiAgIH0pO1xuXG4gICBkZXNjcmliZShcIm1rZGlyXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgbGV0IGRpck5hbWUgPSBwYXRoLnJlc29sdmUoX19kaXJuYW1lLCBcInRtcFwiKTtcblxuICAgICBpdChcInNob3VsZCBtYWtlIGEgZGlyZWN0b3J5IHRoYXQgZG9lc24ndCBleGlzdFwiLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgYXdhaXQgZnMucmltcmFmKGRpck5hbWUpO1xuICAgICAgIGF3YWl0IGZzLm1rZGlyKGRpck5hbWUpO1xuICAgICAgIGxldCBleGlzdHMgPSBhd2FpdCBmcy5oYXNBY2Nlc3MoZGlyTmFtZSk7XG4gICAgICAgZXhpc3RzLnNob3VsZC5iZS50cnVlO1xuICAgICB9KTtcblxuICAgICBpdChcInNob3VsZCBub3QgY29tcGxhaW4gaWYgdGhlIGRpciBhbHJlYWR5IGV4aXN0c1wiLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgICBsZXQgZXhpc3RzID0gYXdhaXQgZnMuaGFzQWNjZXNzKGRpck5hbWUpO1xuICAgICAgICAgZXhpc3RzLnNob3VsZC5iZS50cnVlO1xuICAgICAgICAgYXdhaXQgZnMubWtkaXIoZGlyTmFtZSk7XG4gICAgIH0pO1xuXG4gICAgIGl0KFwic2hvdWxkIHN0aWxsIHRocm93IGFuIGVycm9yIGlmIHNvbWV0aGluZyBlbHNlIGdvZXMgd3JvbmdcIiwgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgIGF3YWl0IGZzLm1rZGlyKFwiL2Jpbi9mb29cIikuc2hvdWxkLmJlLnJlamVjdGVkO1xuICAgICB9KTtcbiAgIH0pO1xuXG4gICBpdCgnaGFzQWNjZXNzJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBleGlzdGluZ1BhdGggPSBwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnZnMtc3BlY3MuanMnKTtcbiAgICAoYXdhaXQgZnMuZXhpc3RzKGV4aXN0aW5nUGF0aCkpLnNob3VsZC5iZS5vaztcbiAgICBsZXQgbm9uRXhpc3RpbmdQYXRoID0gcGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJ3dyb25nLXNwZWNzLmpzJyk7XG4gICAgKGF3YWl0IGZzLmhhc0FjY2Vzcyhub25FeGlzdGluZ1BhdGgpKS5zaG91bGQubm90LmJlLm9rO1xuICB9KTtcbiAgaXQoJ2V4aXN0cycsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZXhpc3RpbmdQYXRoID0gcGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJ2ZzLXNwZWNzLmpzJyk7XG4gICAgKGF3YWl0IGZzLmV4aXN0cyhleGlzdGluZ1BhdGgpKS5zaG91bGQuYmUub2s7XG4gICAgbGV0IG5vbkV4aXN0aW5nUGF0aCA9IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICd3cm9uZy1zcGVjcy5qcycpO1xuICAgIChhd2FpdCBmcy5leGlzdHMobm9uRXhpc3RpbmdQYXRoKSkuc2hvdWxkLm5vdC5iZS5vaztcbiAgfSk7XG4gIGl0KCdyZWFkRmlsZScsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZXhpc3RpbmdQYXRoID0gcGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJ2ZzLXNwZWNzLmpzJyk7XG4gICAgKGF3YWl0IGZzLnJlYWRGaWxlKGV4aXN0aW5nUGF0aCwgJ3V0ZjgnKSkuc2hvdWxkLmNvbnRhaW4oJ3JlYWRGaWxlJyk7XG4gIH0pO1xuICBpdCgnY29weUZpbGUnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGV4aXN0aW5nUGF0aCA9IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICdmcy1zcGVjcy5qcycpO1xuICAgIGxldCBuZXdQYXRoID0gcGF0aC5yZXNvbHZlKCcvdG1wJywgJ2ZzLXNwZWNzLmpzJyk7XG4gICAgYXdhaXQgZnMuY29weUZpbGUoZXhpc3RpbmdQYXRoLCBuZXdQYXRoKTtcbiAgICAoYXdhaXQgZnMucmVhZEZpbGUobmV3UGF0aCwgJ3V0ZjgnKSkuc2hvdWxkLmNvbnRhaW4oJ3JlYWRGaWxlJyk7XG4gIH0pO1xuICBpdCgncmltcmFmJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBuZXdQYXRoID0gcGF0aC5yZXNvbHZlKCcvdG1wJywgJ2ZzLXNwZWNzLmpzJyk7XG4gICAgKGF3YWl0IGZzLmV4aXN0cyhuZXdQYXRoKSkuc2hvdWxkLmJlLnRydWU7XG4gICAgYXdhaXQgZnMucmltcmFmKG5ld1BhdGgpO1xuICAgIChhd2FpdCBmcy5leGlzdHMobmV3UGF0aCkpLnNob3VsZC5iZS5mYWxzZTtcbiAgfSk7XG4gIGl0KCdtZDUnLCBhc3luYyAoKSA9PiB7XG4gICAgbGV0IGV4aXN0aW5nUGF0aCA9IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICdmcy1zcGVjcy5qcycpO1xuICAgIChhd2FpdCBmcy5tZDUoZXhpc3RpbmdQYXRoKSkuc2hvdWxkLmhhdmUubGVuZ3RoKDMyKTtcbiAgfSk7XG4gIGl0KCdzdGF0JywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBleGlzdGluZ1BhdGggPSBwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnZnMtc3BlY3MuanMnKTtcbiAgICBsZXQgc3RhdCA9IGF3YWl0IGZzLnN0YXQoZXhpc3RpbmdQYXRoKTtcbiAgICBzdGF0LnNob3VsZC5oYXZlLnByb3BlcnR5KCdhdGltZScpO1xuICB9KTtcbiAgaXQoJ3doaWNoJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBzeXN0ZW1OcG1QYXRoID0gKGF3YWl0IGV4ZWMoJ3doaWNoJywgWyducG0nXSkpLnN0ZG91dC50cmltKCk7XG4gICAgbGV0IG5wbVBhdGggPSBhd2FpdCBmcy53aGljaCgnbnBtJyk7XG4gICAgbnBtUGF0aC5zaG91bGQuZXF1YWwoc3lzdGVtTnBtUGF0aCk7XG4gIH0pO1xuICBpdCgnZ2xvYicsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgZ2xvYiA9ICd0ZXN0Lyotc3BlY3MuanMnO1xuICAgIGxldCB0ZXN0cyA9IGF3YWl0IGZzLmdsb2IoZ2xvYik7XG4gICAgdGVzdHMuc2hvdWxkLmJlLmFuKCdhcnJheScpO1xuICAgIHRlc3RzLnNob3VsZC5oYXZlLmxlbmd0aC5hYm92ZSgyKTtcbiAgfSk7XG59KTtcbiJdfQ==