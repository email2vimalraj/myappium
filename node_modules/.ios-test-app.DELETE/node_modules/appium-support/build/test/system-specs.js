'use strict';

var _slicedToArray = require('babel-runtime/helpers/sliced-to-array')['default'];

var _Symbol = require('babel-runtime/core-js/symbol')['default'];

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _getIterator = require('babel-runtime/core-js/get-iterator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _interopRequireWildcard = require('babel-runtime/helpers/interop-require-wildcard')['default'];

var _this = this;

var _indexJs = require('../index.js');

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _os = require('os');

var _os2 = _interopRequireDefault(_os);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _teen_process = require('teen_process');

var teen_process = _interopRequireWildcard(_teen_process);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

_chai2['default'].should();

var sandbox = undefined,
    tpMock = undefined,
    osMock = null;
var SANDBOX = _Symbol();
var mocks = {};
var libs = { teen_process: teen_process, os: _os2['default'], system: _indexJs.system };

describe('system', function () {
  describe('isX functions', function () {
    beforeEach(function () {
      osMock = _sinon2['default'].mock(_os2['default']);
    });
    afterEach(function () {
      osMock.verify();
      osMock.restore();
    });

    it('should correctly return Windows System if it is a Windows', function () {
      osMock.expects('type').returns('Windows_NT');
      _indexJs.system.isWindows().should.equal['true'];
    });

    it('should correctly return Mac if it is a Mac', function () {
      osMock.expects('type').returns('Darwin');
      _indexJs.system.isMac().should.equal['true'];
    });

    it('should correctly return Linux if it is a Linux', function () {
      osMock.expects('type').twice().returns('Linux');
      _indexJs.system.isLinux().should.equal['true'];
    });
  });

  describe('mac OSX version', function () {
    beforeEach(function () {
      tpMock = _sinon2['default'].mock(teen_process);
    });
    afterEach(function () {
      tpMock.verify();
      tpMock.restore();
    });

    it('should return correct version for 10.10.5', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            tpMock.expects('exec').once().withExactArgs('sw_vers', ['-productVersion']).returns({ stdout: '10.10.5' });
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(_indexJs.system.macOsxVersion().should.eventually.equal('10.10'));

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it("should throw an error if OSX version can't be determined", function callee$2$0() {
      var invalidOsx;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            invalidOsx = '99.99.99';

            tpMock.expects('exec').once().withExactArgs('sw_vers', ['-productVersion']).returns({ stdout: invalidOsx });
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(_indexJs.system.macOsxVersion().should.eventually.be.rejectedWith(invalidOsx));

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });

  describe('architecture', function () {
    beforeEach(function () {
      sandbox = _sinon2['default'].sandbox.create();
      mocks[SANDBOX] = sandbox;
      var _iteratorNormalCompletion = true;
      var _didIteratorError = false;
      var _iteratorError = undefined;

      try {
        for (var _iterator = _getIterator(_lodash2['default'].toPairs(libs)), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
          var _step$value = _slicedToArray(_step.value, 2);

          var key = _step$value[0];
          var value = _step$value[1];

          mocks[key] = sandbox.mock(value);
        }
      } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion && _iterator['return']) {
            _iterator['return']();
          }
        } finally {
          if (_didIteratorError) {
            throw _iteratorError;
          }
        }
      }
    });

    afterEach(function () {
      sandbox.restore();
    });

    it('should return correct architecture if it is a 64 bit Mac/Linux', function callee$2$0() {
      var arch;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            mocks.os.expects('type').thrice().returns('Darwin');
            mocks.teen_process.expects('exec').once().withExactArgs('uname', ['-m']).returns({ stdout: 'x86_64' });
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(_indexJs.system.arch());

          case 4:
            arch = context$3$0.sent;

            arch.should.equal('64');
            mocks[SANDBOX].verify();

          case 7:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should return correct architecture if it is a 32 bit Mac/Linux', function callee$2$0() {
      var arch;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            mocks.os.expects('type').twice().returns('Linux');
            mocks.teen_process.expects('exec').once().withExactArgs('uname', ['-m']).returns({ stdout: 'i686' });
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(_indexJs.system.arch());

          case 4:
            arch = context$3$0.sent;

            arch.should.equal('32');
            mocks[SANDBOX].verify();

          case 7:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should return correct architecture if it is a 64 bit Windows', function callee$2$0() {
      var arch;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            mocks.os.expects('type').thrice().returns('Windows_NT');
            mocks.system.expects('isOSWin64').once().returns(true);
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(_indexJs.system.arch());

          case 4:
            arch = context$3$0.sent;

            arch.should.equal('64');
            mocks[SANDBOX].verify();

          case 7:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    it('should return correct architecture if it is a 32 bit Windows', function callee$2$0() {
      var arch;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            mocks.os.expects('type').thrice().returns('Windows_NT');
            mocks.system.expects('isOSWin64').once().returns(false);
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(_indexJs.system.arch());

          case 4:
            arch = context$3$0.sent;

            arch.should.equal('32');
            mocks[SANDBOX].verify();

          case 7:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });
  });

  it('should know architecture', function () {
    return _indexJs.system.arch();
  });
});
//# sourceMappingURL=data:application/json;base64,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QyxPQUFPLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQzs7Ozs7OztLQUN6QixDQUFDLENBQUM7O0FBRUgsTUFBRSxDQUFDLDhEQUE4RCxFQUFFO1VBRzdELElBQUk7Ozs7QUFGUixpQkFBSyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBQ3hELGlCQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7OzZDQUN2QyxnQkFBTyxJQUFJLEVBQUU7OztBQUExQixnQkFBSTs7QUFDUixnQkFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDeEIsaUJBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQzs7Ozs7OztLQUN6QixDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7O0FBRUgsSUFBRSxDQUFDLDBCQUEwQixFQUFFLFlBQU07QUFDbkMsV0FBTyxnQkFBTyxJQUFJLEVBQUUsQ0FBQztHQUN0QixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMiLCJmaWxlIjoidGVzdC9zeXN0ZW0tc3BlY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCB7IHN5c3RlbSB9IGZyb20gJy4uL2luZGV4LmpzJztcbmltcG9ydCBjaGFpIGZyb20gJ2NoYWknO1xuaW1wb3J0IG9zIGZyb20gJ29zJztcbmltcG9ydCBzaW5vbiBmcm9tICdzaW5vbic7XG5pbXBvcnQgKiBhcyB0ZWVuX3Byb2Nlc3MgZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5cbmNoYWkuc2hvdWxkKCk7XG5cbmxldCBzYW5kYm94LCB0cE1vY2ssIG9zTW9jayA9IG51bGw7XG5sZXQgU0FOREJPWCA9IFN5bWJvbCgpO1xubGV0IG1vY2tzID0ge307XG5sZXQgbGlicyA9IHt0ZWVuX3Byb2Nlc3MsIG9zLCBzeXN0ZW19O1xuXG5kZXNjcmliZSgnc3lzdGVtJywgKCkgPT4ge1xuICBkZXNjcmliZSgnaXNYIGZ1bmN0aW9ucycsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIG9zTW9jayA9IHNpbm9uLm1vY2sob3MpO1xuICAgIH0pO1xuICAgIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgICBvc01vY2sudmVyaWZ5KCk7XG4gICAgICBvc01vY2sucmVzdG9yZSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjb3JyZWN0bHkgcmV0dXJuIFdpbmRvd3MgU3lzdGVtIGlmIGl0IGlzIGEgV2luZG93cycsICgpID0+IHtcbiAgICAgIG9zTW9jay5leHBlY3RzKCd0eXBlJykucmV0dXJucygnV2luZG93c19OVCcpO1xuICAgICAgc3lzdGVtLmlzV2luZG93cygpLnNob3VsZC5lcXVhbC50cnVlO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjb3JyZWN0bHkgcmV0dXJuIE1hYyBpZiBpdCBpcyBhIE1hYycsICgpID0+IHtcbiAgICAgIG9zTW9jay5leHBlY3RzKCd0eXBlJykucmV0dXJucygnRGFyd2luJyk7XG4gICAgICBzeXN0ZW0uaXNNYWMoKS5zaG91bGQuZXF1YWwudHJ1ZTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY29ycmVjdGx5IHJldHVybiBMaW51eCBpZiBpdCBpcyBhIExpbnV4JywgKCkgPT4ge1xuICAgICAgb3NNb2NrLmV4cGVjdHMoJ3R5cGUnKS50d2ljZSgpLnJldHVybnMoJ0xpbnV4Jyk7XG4gICAgICBzeXN0ZW0uaXNMaW51eCgpLnNob3VsZC5lcXVhbC50cnVlO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbWFjIE9TWCB2ZXJzaW9uJywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgdHBNb2NrID0gc2lub24ubW9jayh0ZWVuX3Byb2Nlc3MpO1xuICAgIH0pO1xuICAgIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgICB0cE1vY2sudmVyaWZ5KCk7XG4gICAgICB0cE1vY2sucmVzdG9yZSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY29ycmVjdCB2ZXJzaW9uIGZvciAxMC4xMC41JywgYXN5bmMgKCkgPT4ge1xuICAgICAgdHBNb2NrLmV4cGVjdHMoJ2V4ZWMnKS5vbmNlKCkud2l0aEV4YWN0QXJncygnc3dfdmVycycsIFsnLXByb2R1Y3RWZXJzaW9uJ10pLnJldHVybnMoe3N0ZG91dDogJzEwLjEwLjUnfSk7XG4gICAgICBhd2FpdCBzeXN0ZW0ubWFjT3N4VmVyc2lvbigpLnNob3VsZC5ldmVudHVhbGx5LmVxdWFsKCcxMC4xMCcpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgdGhyb3cgYW4gZXJyb3IgaWYgT1NYIHZlcnNpb24gY2FuJ3QgYmUgZGV0ZXJtaW5lZFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgaW52YWxpZE9zeCA9ICc5OS45OS45OSc7XG4gICAgICB0cE1vY2suZXhwZWN0cygnZXhlYycpLm9uY2UoKS53aXRoRXhhY3RBcmdzKCdzd192ZXJzJywgWyctcHJvZHVjdFZlcnNpb24nXSkucmV0dXJucyh7c3Rkb3V0OiBpbnZhbGlkT3N4fSk7XG4gICAgICBhd2FpdCBzeXN0ZW0ubWFjT3N4VmVyc2lvbigpLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkV2l0aChpbnZhbGlkT3N4KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2FyY2hpdGVjdHVyZScsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIHNhbmRib3ggPSBzaW5vbi5zYW5kYm94LmNyZWF0ZSgpO1xuICAgICAgbW9ja3NbU0FOREJPWF0gPSBzYW5kYm94O1xuICAgICAgZm9yIChsZXQgW2tleSwgdmFsdWVdIG9mIF8udG9QYWlycyhsaWJzKSkge1xuICAgICAgICBtb2Nrc1trZXldID0gc2FuZGJveC5tb2NrKHZhbHVlKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgICBzYW5kYm94LnJlc3RvcmUoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvcnJlY3QgYXJjaGl0ZWN0dXJlIGlmIGl0IGlzIGEgNjQgYml0IE1hYy9MaW51eCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tzLm9zLmV4cGVjdHMoJ3R5cGUnKS50aHJpY2UoKS5yZXR1cm5zKCdEYXJ3aW4nKTtcbiAgICAgIG1vY2tzLnRlZW5fcHJvY2Vzcy5leHBlY3RzKCdleGVjJykub25jZSgpLndpdGhFeGFjdEFyZ3MoJ3VuYW1lJywgWyctbSddKS5yZXR1cm5zKHtzdGRvdXQ6ICd4ODZfNjQnfSk7XG4gICAgICBsZXQgYXJjaCA9IGF3YWl0IHN5c3RlbS5hcmNoKCk7XG4gICAgICBhcmNoLnNob3VsZC5lcXVhbCgnNjQnKTtcbiAgICAgIG1vY2tzW1NBTkRCT1hdLnZlcmlmeSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY29ycmVjdCBhcmNoaXRlY3R1cmUgaWYgaXQgaXMgYSAzMiBiaXQgTWFjL0xpbnV4JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja3Mub3MuZXhwZWN0cygndHlwZScpLnR3aWNlKCkucmV0dXJucygnTGludXgnKTtcbiAgICAgIG1vY2tzLnRlZW5fcHJvY2Vzcy5leHBlY3RzKCdleGVjJykub25jZSgpLndpdGhFeGFjdEFyZ3MoJ3VuYW1lJywgWyctbSddKS5yZXR1cm5zKHtzdGRvdXQ6ICdpNjg2J30pO1xuICAgICAgbGV0IGFyY2ggPSBhd2FpdCBzeXN0ZW0uYXJjaCgpO1xuICAgICAgYXJjaC5zaG91bGQuZXF1YWwoJzMyJyk7XG4gICAgICBtb2Nrc1tTQU5EQk9YXS52ZXJpZnkoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvcnJlY3QgYXJjaGl0ZWN0dXJlIGlmIGl0IGlzIGEgNjQgYml0IFdpbmRvd3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2Nrcy5vcy5leHBlY3RzKCd0eXBlJykudGhyaWNlKCkucmV0dXJucygnV2luZG93c19OVCcpO1xuICAgICAgbW9ja3Muc3lzdGVtLmV4cGVjdHMoJ2lzT1NXaW42NCcpLm9uY2UoKS5yZXR1cm5zKHRydWUpO1xuICAgICAgbGV0IGFyY2ggPSBhd2FpdCBzeXN0ZW0uYXJjaCgpO1xuICAgICAgYXJjaC5zaG91bGQuZXF1YWwoJzY0Jyk7XG4gICAgICBtb2Nrc1tTQU5EQk9YXS52ZXJpZnkoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvcnJlY3QgYXJjaGl0ZWN0dXJlIGlmIGl0IGlzIGEgMzIgYml0IFdpbmRvd3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2Nrcy5vcy5leHBlY3RzKCd0eXBlJykudGhyaWNlKCkucmV0dXJucygnV2luZG93c19OVCcpO1xuICAgICAgbW9ja3Muc3lzdGVtLmV4cGVjdHMoJ2lzT1NXaW42NCcpLm9uY2UoKS5yZXR1cm5zKGZhbHNlKTtcbiAgICAgIGxldCBhcmNoID0gYXdhaXQgc3lzdGVtLmFyY2goKTtcbiAgICAgIGFyY2guc2hvdWxkLmVxdWFsKCczMicpO1xuICAgICAgbW9ja3NbU0FOREJPWF0udmVyaWZ5KCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQga25vdyBhcmNoaXRlY3R1cmUnLCAoKSA9PiB7XG4gICAgcmV0dXJuIHN5c3RlbS5hcmNoKCk7XG4gIH0pO1xufSk7XG4iXX0=