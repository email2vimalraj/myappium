require('source-map-support').install();

'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _this = this;

var _index = require('../index');

var _index2 = _interopRequireDefault(_index);

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _appiumSupport = require('appium-support');

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var should = _chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

describe('xcode @skip-linux', function () {

  it('should get the path to xcode executable', function callee$1$0() {
    var path;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_index2['default'].getPath());

        case 2:
          path = context$2$0.sent;

          should.exist(path);
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(_appiumSupport.fs.exists(path));

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  describe('getVersion', function () {
    var versionRE = /\d\.\d\.*\d*/;

    it('should get the version of xcode', function callee$2$0() {
      var version;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_index2['default'].getVersion());

          case 2:
            version = context$3$0.sent;

            should.exist(version);
            _lodash2['default'].isString(version).should.be['true'];
            versionRE.test(version).should.be['true'];

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should get the path and version again, these values are cached', function callee$2$0() {
      var before, path, after, version;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_index2['default'].getPath());

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(_index2['default'].getVersion());

          case 4:
            before = new Date();
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap(_index2['default'].getPath());

          case 7:
            path = context$3$0.sent;
            after = new Date();

            should.exist(path);
            context$3$0.next = 12;
            return _regeneratorRuntime.awrap(_appiumSupport.fs.exists(path));

          case 12:
            (after - before).should.be.at.most(2);

            before = new Date();
            context$3$0.next = 16;
            return _regeneratorRuntime.awrap(_index2['default'].getVersion());

          case 16:
            version = context$3$0.sent;

            after = new Date();

            should.exist(version);
            _lodash2['default'].isString(version).should.be['true'];
            versionRE.test(version).should.be['true'];
            (after - before).should.be.at.most(2);

          case 22:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });

    it('should get the parsed version', function callee$2$0() {
      var nonParsedVersion, version;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_index2['default'].getVersion());

          case 2:
            nonParsedVersion = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(_index2['default'].getVersion(true));

          case 5:
            version = context$3$0.sent;

            should.exist(version);
            _lodash2['default'].isString(version.versionString).should.be['true'];
            version.versionString.should.eql(nonParsedVersion);

            parseFloat(version.versionFloat).should.equal(version.versionFloat);
            parseInt(version.major).should.equal(version.major);
            parseInt(version.minor).should.equal(version.minor);

          case 12:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });

  it('should clear the cache if asked to', function callee$1$0() {
    var before, after;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:

          _index2['default'].clearInternalCache();

          before = new Date();
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap(_index2['default'].getPath());

        case 4:
          after = new Date();

          (after - before).should.be.at.least(6);

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  it('should find the automation trace template', function callee$1$0() {
    var path, suffix;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_index2['default'].getAutomationTraceTemplatePath());

        case 2:
          path = context$2$0.sent;

          should.exist(path);
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(_appiumSupport.fs.exists(path).should.eventually.be['true']);

        case 6:
          suffix = ".tracetemplate";

          path.slice(-suffix.length).should.equal(suffix);

        case 8:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should get max iOS SDK version', function callee$1$0() {
    var version;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_index2['default'].getMaxIOSSDK());

        case 2:
          version = context$2$0.sent;

          should.exist(version);
          (typeof version).should.equal('string');
          (parseFloat(version) - 6.1).should.be.at.least(0);

        case 6:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should get a list of iOS devices', function callee$1$0() {
    var devices;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_index2['default'].getConnectedDevices());

        case 2:
          devices = context$2$0.sent;

          should.exist(devices);
          (typeof devices).should.equal('object');

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  it('should get the path to instruments binary', function callee$1$0() {
    var instrumentsPath;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(_index2['default'].getInstrumentsPath());

        case 2:
          instrumentsPath = context$2$0.sent;

          should.exist(instrumentsPath);
          (typeof instrumentsPath).should.equal('string');
          instrumentsPath.length.should.be.above(3);
          context$2$0.next = 8;
          return _regeneratorRuntime.awrap(_appiumSupport.fs.exists(instrumentsPath));

        case 8:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });
});
//# sourceMappingURL=data:application/json;base64,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QUFHLE1BQU0sQ0FBQyxlQUFlLENBQUM7Ozs7Ozs7R0FDakMsQ0FBQyxDQUFDO0NBQ0osQ0FBQyxDQUFDIiwiZmlsZSI6InRlc3QveGNvZGUtc3BlY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyB0cmFuc3BpbGU6bW9jaGFcblxuaW1wb3J0IHhjb2RlIGZyb20gJy4uL2luZGV4JztcbmltcG9ydCBjaGFpIGZyb20gJ2NoYWknO1xuaW1wb3J0IGNoYWlBc1Byb21pc2VkIGZyb20gJ2NoYWktYXMtcHJvbWlzZWQnO1xuaW1wb3J0IHsgZnMgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuXG5cbmxldCBzaG91bGQgPSBjaGFpLnNob3VsZCgpO1xuY2hhaS51c2UoY2hhaUFzUHJvbWlzZWQpO1xuXG5kZXNjcmliZSgneGNvZGUgQHNraXAtbGludXgnLCAoKSA9PiB7XG5cbiAgaXQoJ3Nob3VsZCBnZXQgdGhlIHBhdGggdG8geGNvZGUgZXhlY3V0YWJsZScsIGFzeW5jIGZ1bmN0aW9uICgpIHtcblxuICAgIGxldCBwYXRoID0gYXdhaXQgeGNvZGUuZ2V0UGF0aCgpO1xuICAgIHNob3VsZC5leGlzdChwYXRoKTtcbiAgICBhd2FpdCBmcy5leGlzdHMocGF0aCk7XG5cbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFZlcnNpb24nLCAoKSA9PiB7XG4gICAgbGV0IHZlcnNpb25SRSA9IC9cXGRcXC5cXGRcXC4qXFxkKi87XG5cbiAgICBpdCgnc2hvdWxkIGdldCB0aGUgdmVyc2lvbiBvZiB4Y29kZScsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGxldCB2ZXJzaW9uID0gYXdhaXQgeGNvZGUuZ2V0VmVyc2lvbigpO1xuICAgICAgc2hvdWxkLmV4aXN0KHZlcnNpb24pO1xuICAgICAgXy5pc1N0cmluZyh2ZXJzaW9uKS5zaG91bGQuYmUudHJ1ZTtcbiAgICAgIHZlcnNpb25SRS50ZXN0KHZlcnNpb24pLnNob3VsZC5iZS50cnVlO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBnZXQgdGhlIHBhdGggYW5kIHZlcnNpb24gYWdhaW4sIHRoZXNlIHZhbHVlcyBhcmUgY2FjaGVkJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgYXdhaXQgeGNvZGUuZ2V0UGF0aCgpO1xuICAgICAgYXdhaXQgeGNvZGUuZ2V0VmVyc2lvbigpO1xuXG4gICAgICBsZXQgYmVmb3JlID0gbmV3IERhdGUoKTtcbiAgICAgIGxldCBwYXRoID0gYXdhaXQgeGNvZGUuZ2V0UGF0aCgpO1xuICAgICAgbGV0IGFmdGVyID0gbmV3IERhdGUoKTtcblxuICAgICAgc2hvdWxkLmV4aXN0KHBhdGgpO1xuICAgICAgYXdhaXQgZnMuZXhpc3RzKHBhdGgpO1xuICAgICAgKGFmdGVyLWJlZm9yZSkuc2hvdWxkLmJlLmF0Lm1vc3QoMik7XG5cbiAgICAgIGJlZm9yZSA9IG5ldyBEYXRlKCk7XG4gICAgICBsZXQgdmVyc2lvbiA9IGF3YWl0IHhjb2RlLmdldFZlcnNpb24oKTtcbiAgICAgIGFmdGVyID0gbmV3IERhdGUoKTtcblxuICAgICAgc2hvdWxkLmV4aXN0KHZlcnNpb24pO1xuICAgICAgXy5pc1N0cmluZyh2ZXJzaW9uKS5zaG91bGQuYmUudHJ1ZTtcbiAgICAgIHZlcnNpb25SRS50ZXN0KHZlcnNpb24pLnNob3VsZC5iZS50cnVlO1xuICAgICAgKGFmdGVyLWJlZm9yZSkuc2hvdWxkLmJlLmF0Lm1vc3QoMik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdldCB0aGUgcGFyc2VkIHZlcnNpb24nLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBsZXQgbm9uUGFyc2VkVmVyc2lvbiA9IGF3YWl0IHhjb2RlLmdldFZlcnNpb24oKTtcbiAgICAgIGxldCB2ZXJzaW9uID0gYXdhaXQgeGNvZGUuZ2V0VmVyc2lvbih0cnVlKTtcbiAgICAgIHNob3VsZC5leGlzdCh2ZXJzaW9uKTtcbiAgICAgIF8uaXNTdHJpbmcodmVyc2lvbi52ZXJzaW9uU3RyaW5nKS5zaG91bGQuYmUudHJ1ZTtcbiAgICAgIHZlcnNpb24udmVyc2lvblN0cmluZy5zaG91bGQuZXFsKG5vblBhcnNlZFZlcnNpb24pO1xuXG4gICAgICBwYXJzZUZsb2F0KHZlcnNpb24udmVyc2lvbkZsb2F0KS5zaG91bGQuZXF1YWwodmVyc2lvbi52ZXJzaW9uRmxvYXQpO1xuICAgICAgcGFyc2VJbnQodmVyc2lvbi5tYWpvcikuc2hvdWxkLmVxdWFsKHZlcnNpb24ubWFqb3IpO1xuICAgICAgcGFyc2VJbnQodmVyc2lvbi5taW5vcikuc2hvdWxkLmVxdWFsKHZlcnNpb24ubWlub3IpO1xuICAgIH0pO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGNsZWFyIHRoZSBjYWNoZSBpZiBhc2tlZCB0bycsIGFzeW5jIGZ1bmN0aW9uICgpIHtcblxuICAgIHhjb2RlLmNsZWFySW50ZXJuYWxDYWNoZSgpO1xuXG4gICAgbGV0IGJlZm9yZSA9IG5ldyBEYXRlKCk7XG4gICAgYXdhaXQgeGNvZGUuZ2V0UGF0aCgpO1xuICAgIGxldCBhZnRlciA9IG5ldyBEYXRlKCk7XG4gICAgKGFmdGVyLWJlZm9yZSkuc2hvdWxkLmJlLmF0LmxlYXN0KDYpO1xuXG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgZmluZCB0aGUgYXV0b21hdGlvbiB0cmFjZSB0ZW1wbGF0ZScsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgcGF0aCA9IGF3YWl0IHhjb2RlLmdldEF1dG9tYXRpb25UcmFjZVRlbXBsYXRlUGF0aCgpO1xuXG4gICAgc2hvdWxkLmV4aXN0KHBhdGgpO1xuICAgIGF3YWl0IGZzLmV4aXN0cyhwYXRoKS5zaG91bGQuZXZlbnR1YWxseS5iZS50cnVlO1xuICAgIGxldCBzdWZmaXggPSBcIi50cmFjZXRlbXBsYXRlXCI7XG4gICAgcGF0aC5zbGljZSgtc3VmZml4Lmxlbmd0aCkuc2hvdWxkLmVxdWFsKHN1ZmZpeCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgZ2V0IG1heCBpT1MgU0RLIHZlcnNpb24nLCBhc3luYygpID0+IHtcbiAgICBsZXQgdmVyc2lvbiA9IGF3YWl0IHhjb2RlLmdldE1heElPU1NESygpO1xuXG4gICAgc2hvdWxkLmV4aXN0KHZlcnNpb24pO1xuICAgICh0eXBlb2YgdmVyc2lvbikuc2hvdWxkLmVxdWFsKCdzdHJpbmcnKTtcbiAgICAocGFyc2VGbG9hdCh2ZXJzaW9uKS02LjEpLnNob3VsZC5iZS5hdC5sZWFzdCgwKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBnZXQgYSBsaXN0IG9mIGlPUyBkZXZpY2VzJywgYXN5bmMoKSA9PiB7XG4gICAgbGV0IGRldmljZXMgPSBhd2FpdCB4Y29kZS5nZXRDb25uZWN0ZWREZXZpY2VzKCk7XG4gICAgc2hvdWxkLmV4aXN0KGRldmljZXMpO1xuICAgICh0eXBlb2YgZGV2aWNlcykuc2hvdWxkLmVxdWFsKCdvYmplY3QnKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBnZXQgdGhlIHBhdGggdG8gaW5zdHJ1bWVudHMgYmluYXJ5JywgYXN5bmMoKSA9PiB7XG4gICAgbGV0IGluc3RydW1lbnRzUGF0aCA9IGF3YWl0IHhjb2RlLmdldEluc3RydW1lbnRzUGF0aCgpO1xuXG4gICAgc2hvdWxkLmV4aXN0KGluc3RydW1lbnRzUGF0aCk7XG4gICAgKHR5cGVvZiBpbnN0cnVtZW50c1BhdGgpLnNob3VsZC5lcXVhbCgnc3RyaW5nJyk7XG4gICAgaW5zdHJ1bWVudHNQYXRoLmxlbmd0aC5zaG91bGQuYmUuYWJvdmUoMyk7XG4gICAgYXdhaXQgZnMuZXhpc3RzKGluc3RydW1lbnRzUGF0aCk7XG4gIH0pO1xufSk7XG4iXX0=